{% extends "layout.html" %}
{% block content %}

<style>
/* â”€â”€ Learn Dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.learn-hero {
  margin-bottom: 2rem;
}
.learn-hero h2 {
  font-family: 'DM Serif Display', serif;
  font-size: 2rem;
  color: #1a2535;
  margin-bottom: .25rem;
}
.learn-hero p {
  color: #6b7280;
  font-size: .95rem;
}

/* Level card */
.level-card {
  border: 1.5px solid #e5e0d8;
  border-radius: 12px;
  margin-bottom: 1.5rem;
  overflow: hidden;
  background: #fff;
  box-shadow: 0 2px 8px rgba(26,37,53,.06);
}
.level-header {
  padding: 1.1rem 1.4rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  user-select: none;
  transition: background .15s;
}
.level-header:hover { background: #faf8f4; }
.level-header-left { display: flex; align-items: center; gap: .85rem; }
.level-icon {
  width: 44px; height: 44px;
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.35rem;
  flex-shrink: 0;
}
.level-title { font-family: 'DM Serif Display', serif; font-size: 1.2rem; color: #1a2535; }
.level-subtitle { font-size: .8rem; color: #8a8a8a; margin-top: 1px; }
.level-badge {
  font-size: .72rem; font-weight: 600; letter-spacing: .04em;
  padding: .28rem .7rem; border-radius: 20px;
}
.badge-locked   { background: #f0ede8; color: #9a8f85; }
.badge-unlocked { background: #eaf6ee; color: #27a35a; }
.badge-done     { background: #e8f0fc; color: #2563eb; }

/* Progress bar */
.level-progress-wrap { padding: 0 1.4rem .35rem; }
.level-progress-bar {
  height: 4px; border-radius: 4px; background: #f0ede8;
  overflow: hidden;
}
.level-progress-fill { height: 100%; border-radius: 4px; transition: width .5s ease; }

/* Module list */
.module-list { border-top: 1px solid #f0ede8; }
.module-row {
  display: flex; align-items: center;
  padding: .85rem 1.4rem;
  border-bottom: 1px solid #f7f5f0;
  text-decoration: none; color: inherit;
  transition: background .12s;
  gap: .9rem;
}
.module-row:last-child { border-bottom: none; }
.module-row:hover { background: #faf8f4; text-decoration: none; color: inherit; }
.module-row.locked-row { opacity: .5; cursor: not-allowed; pointer-events: none; }

.module-check {
  width: 22px; height: 22px; border-radius: 50%;
  border: 2px solid #d5cfc6;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0; transition: all .2s;
}
.module-check.done {
  background: #27a35a; border-color: #27a35a; color: #fff;
}
.module-num {
  font-size: .72rem; font-weight: 700; color: #a09a93;
  width: 1.4rem; flex-shrink: 0; text-align: center;
}
.module-info { flex: 1; }
.module-title { font-weight: 500; font-size: .93rem; color: #1a2535; line-height: 1.3; }
.module-desc { font-size: .78rem; color: #9a8f85; margin-top: 2px; }
.module-pts {
  font-size: .75rem; font-weight: 600; color: #b84c27;
  background: #fdf0ea; padding: .2rem .55rem; border-radius: 10px;
  flex-shrink: 0;
}

/* Locked overlay */
.locked-body {
  padding: 1.5rem 1.4rem;
  display: flex; align-items: center; gap: 1rem;
  background: #faf8f4;
}
.locked-body p { margin: 0; font-size: .88rem; color: #6b7280; }
.btn-unlock {
  background: #1a2535; color: #fff;
  border: none; padding: .45rem 1.1rem;
  border-radius: 8px; font-size: .83rem; font-weight: 500;
  cursor: pointer; text-decoration: none; white-space: nowrap;
  transition: background .15s;
}
.btn-unlock:hover { background: #2e3f58; color: #fff; text-decoration: none; }

.chevron { transition: transform .25s; color: #9a8f85; }
.collapsed .chevron { transform: rotate(-90deg); }
</style>

<div class="learn-hero">
  <h2>Learning Path</h2>
  <p>Master machine learning from first principles to production. Complete modules to earn points.</p>
</div>

{% for ld in level_data %}
<div class="level-card">

  <!-- Header (always clickable to collapse/expand) -->
  <div class="level-header {% if not ld.unlocked %}collapsed{% endif %}"
       data-toggle="collapse"
       data-target="#level-{{ ld.key }}"
       aria-expanded="{{ 'true' if ld.unlocked else 'false' }}">

    <div class="level-header-left">
      <div class="level-icon" style="background: {{ ld.meta.color }}22;">
        {{ ld.meta.icon }}
      </div>
      <div>
        <div class="level-title">{{ ld.meta.label }}</div>
        <div class="level-subtitle">{{ ld.meta.description }}</div>
      </div>
    </div>

    <div class="d-flex align-items-center gap-2" style="gap:.65rem;">
      {% if not ld.unlocked %}
        <span class="level-badge badge-locked">ðŸ”’ Locked</span>
      {% elif ld.done == ld.total and ld.total > 0 %}
        <span class="level-badge badge-done">âœ“ Complete</span>
      {% else %}
        <span class="level-badge badge-unlocked">{{ ld.done }}/{{ ld.total }} done</span>
      {% endif %}
      <svg class="chevron" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
      </svg>
    </div>
  </div>

  <!-- Progress bar -->
  {% if ld.unlocked %}
  <div class="level-progress-wrap">
    <div class="level-progress-bar">
      <div class="level-progress-fill"
           style="width:{{ ld.pct }}%; background:{{ ld.meta.color }};"></div>
    </div>
  </div>
  {% endif %}

  <!-- Collapsible body -->
  <div id="level-{{ ld.key }}"
       class="collapse {% if ld.unlocked %}show{% endif %}">

    {% if ld.unlocked %}
      <div class="module-list">
        {% for mod in ld.modules %}
        <a href="{{ url_for('learn.module_page', module_id=mod.id) }}"
           class="module-row">
          <div class="module-check {% if mod.id in completed %}done{% endif %}">
            {% if mod.id in completed %}
            <svg width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
            </svg>
            {% endif %}
          </div>
          <span class="module-num">{{ loop.index }}</span>
          <div class="module-info">
            <div class="module-title">{{ mod.title }}</div>
            <div class="module-desc">{{ mod.description }}</div>
          </div>
          <span class="module-pts">+{{ mod.points }} pts</span>
        </a>
        {% endfor %}
      </div>

    {% else %}
      <div class="locked-body">
        <div style="font-size:1.8rem;">ðŸ”’</div>
        <div>
          <p><strong>This level is locked.</strong> Pass the unlock quiz to access
          {{ ld.total }} modules and earn up to
          {{ ld.modules | sum(attribute='points') + 5 }} points.</p>
        </div>
        <a href="{{ url_for('learn.unlock_quiz', level=ld.key) }}"
           class="btn-unlock ml-auto">Take Quiz â†’</a>
      </div>
    {% endif %}

  </div>
</div>
{% endfor %}

{% endblock content %}
